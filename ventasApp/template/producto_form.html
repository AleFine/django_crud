{% extends 'index.html' %}

{% block content %}
<div class="mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10">
    <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <h2 class="text-title-md2 font-bold text-black dark:text-white">
            Calculadora Financiera
        </h2>
    </div>

    <div class="rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark">
        <div class="border-b border-stroke px-6.5 py-4 dark:border-strokedark">
            <h3 class="font-medium text-black dark:text-white">Cálculo de Factores Financieros</h3>
        </div>
        <div class="flex flex-col gap-5.5 p-6.5">
            <form method="POST" action="{% url 'calcular_factores' %}" id="calculoForm">
                {% csrf_token %}

                <div>
                    <label class="mb-3 block text-sm font-medium text-black dark:text-white">
                        Tipo de Cálculo
                    </label>
                    <select id="tipo_calculo" name="tipo_calculo" class="relative z-20 w-full appearance-none rounded border-[1.5px] border-stroke bg-transparent py-3 pl-5 pr-12 outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary">
                        <option value="frc" {% if form.data.tipo_calculo == "frc" %}selected{% endif %}>Factor de Recuperación de Capital</option>
                        <option value="fas" {% if form.data.tipo_calculo == "fas" %}selected{% endif %}>Factor de Actualización de la Serie</option>
                    </select>
                </div>

                <div>
                    <label class="mb-3 block text-sm font-medium text-black dark:text-white">
                        Tipo de Tasa
                    </label>
                    <select id="tipo_tasa" name="tipo_tasa" class="relative z-20 w-full appearance-none rounded border-[1.5px] border-stroke bg-transparent py-3 pl-5 pr-12 outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary">
                        <option value="diaria" {% if form.data.tipo_tasa == "diaria" %}selected{% endif %}>Diaria</option>
                        <option value="semanal" {% if form.data.tipo_tasa == "semanal" %}selected{% endif %}>Semanal</option>
                        <option value="mensual" {% if form.data.tipo_tasa == "mensual" %}selected{% endif %}>Mensual</option>
                        <option value="trimestral" {% if form.data.tipo_tasa == "trimestral" %}selected{% endif %}>Trimestral</option>
                        <option value="semestral" {% if form.data.tipo_tasa == "semestral" %}selected{% endif %}>Semestral</option>
                        <option value="anual" {% if form.data.tipo_tasa == "anual" %}selected{% endif %}>Anual</option>
                    </select>
                </div>

                <div>
                    <label class="mb-3 block text-sm font-medium text-black dark:text-white">
                        Tipo de Capitalización
                    </label>
                    <select id="tipo_capitalizacion" name="tipo_capitalizacion" class="relative z-20 w-full appearance-none rounded border-[1.5px] border-stroke bg-transparent py-3 pl-5 pr-12 outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary">
                        <option value="diaria" {% if form.data.tipo_capitalizacion == "diaria" %}selected{% endif %}>Diaria</option>
                        <option value="semanal" {% if form.data.tipo_capitalizacion == "semanal" %}selected{% endif %}>Semanal</option>
                        <option value="mensual" {% if form.data.tipo_capitalizacion == "mensual" %}selected{% endif %}>Mensual</option>
                        <option value="trimestral" {% if form.data.tipo_capitalizacion == "trimestral" %}selected{% endif %}>Trimestral</option>
                        <option value="semestral" {% if form.data.tipo_capitalizacion == "semestral" %}selected{% endif %}>Semestral</option>
                        <option value="anual" {% if form.data.tipo_capitalizacion == "anual" %}selected{% endif %}>Anual</option>
                    </select>
                </div>

                <div>
                    <label class="mb-3 block text-sm font-medium text-black dark:text-white">
                        Tasa de Interés (%)
                    </label>
                    <input value="{{ form.data.tasa }}" type="number" step="0.01" name="tasa" id="tasa" class="w-full rounded-lg border-[1.5px] border-stroke bg-transparent px-5 py-3 font-normal text-black outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary">
                </div>

                <div id="capital_container">
                    <label class="mb-3 block text-sm font-medium text-black dark:text-white" id="label_capital">
                        Capital (P)
                    </label>
                    <input value="{{ form.data.capital }}" type="number" name="capital" id="capital" class="w-full rounded-lg border-[1.5px] border-stroke bg-transparent px-5 py-3 font-normal text-black outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary">
                </div>

                <div id="pago_container" style="display: none;">
                    <label class="mb-3 block text-sm font-medium text-black dark:text-white" id="label_pago_periodico">
                        Pago Periódico (R)
                    </label>
                    <input value="{{ form.data.pago_periodico }}" type="number" name="pago_periodico" id="pago_periodico" class="w-full rounded-lg border-[1.5px] border-stroke bg-transparent px-5 py-3 font-normal text-black outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary">
                </div>

                <div class="flex items-center space-x-3">
                    <div>
                        <label class="mb-3 block text-sm font-medium text-black dark:text-white">
                            Número de Periodos (n)
                        </label>
                        <input value="{{ form.data.periodos }}" type="number" name="periodos" id="periodos" class="w-full rounded-lg border-[1.5px] border-stroke bg-transparent px-5 py-3 font-normal text-black outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary">
                    </div>
                    <div>
                        <label class="mb-3 block text-sm font-medium text-black dark:text-white">
                            Tipo de Periodo
                        </label>
                        <select id="tipo_periodo" name="tipo_periodo" class="relative z-20 w-full appearance-none rounded border-[1.5px] border-stroke bg-transparent py-3 pl-5 pr-12 outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary">
                            <option value="dias" {% if form.data.tipo_periodo == "dias" %}selected{% endif %}>Días</option>
                            <option value="meses" {% if form.data.tipo_periodo == "meses" %}selected{% endif %}>Meses</option>
                            <option value="años" {% if form.data.tipo_periodo == "años" %}selected{% endif %}>Años</option>
                        </select>
                    </div>
                </div>
                <input type="hidden" id="mostrar_resultado" name="mostrar_resultado" value="False">
                <button type="submit" class="mt-6 inline-flex items-center justify-center rounded-md bg-primary px-10 py-4 text-center font-medium text-white hover:bg-opacity-90">
                    Calcular
                </button>
            </form>

            {% if resultado %}  
                <div id="resultado_container" class="mt-4">
                    <h3 class="font-bold text-black dark:text-white" id="resultado_label"></h3>
                    <p class="text-lg" id="resultado">{{ resultado }}</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>

    document.getElementById('calculoForm').addEventListener('submit', function() {
        document.getElementById('mostrar_resultado').value = "True";
    });

    document.getElementById('tipo_calculo').addEventListener('change', function() {
        const tipoCalculo = this.value;
        const capitalContainer = document.getElementById('capital_container');
        const pagoContainer = document.getElementById('pago_container');
        const resultadoText = document.getElementById('resultado');
        const resultadoLabel = document.getElementById('resultado_label');
        
        document.getElementById('capital').value = '';
        document.getElementById('pago_periodico').value = '';
        document.getElementById('tasa').value = '';
        document.getElementById('periodos').value = '';

        document.getElementById('tipo_tasa').selectedIndex = 0;
        document.getElementById('tipo_capitalizacion').selectedIndex = 0;
        document.getElementById('tipo_periodo').selectedIndex = 0;

        document.getElementById('mostrar_resultado').value = "False";

        if (tipoCalculo === 'frc') {
            capitalContainer.style.display = 'block';
            pagoContainer.style.display = 'none';
            resultadoLabel.innerText = "PAGO:";
        } else if (tipoCalculo === 'fas') {
            capitalContainer.style.display = 'none';
            pagoContainer.style.display = 'block';
            resultadoLabel.innerText = "CAPITAL:";
        }
    });

    document.getElementById('tipo_calculo').dispatchEvent(new Event('change'));
</script>

{% endblock content %}
